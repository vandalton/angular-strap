{"version":3,"sources":["modules/compiler.js"],"names":["templateUrl","options","cache","$templateCache","then","element","res","fetchTemplate","template","fetchPromises","$http","get","data","this","compile","controller","console","controllerAs","resolve","locals","bindToController","angular","forEach","value","isString","$injector","key","transformTemplate","identity","extend","$template","when","$q","all","templateEl","Error","findElement","contentTemplate","templates","contentEl","removeAttr","html","replace","next","remove","outerHTML","link","scope","trim","contents","linkFn","invokeCtrl","children","instance","ctrl","isObject","arguments","apply","bsCompilerService","warn","service"],"mappings":"AAOA,YAMA,SAgEQA,mBAAcC,EAAQD,EAAAA,EAAAA,EAAAA,EAAAA,GAU5B,QA+FyDE,GAAOC,EAAAA,GA9F9D,MA+FGC,SAAKC,SAAUC,GAAAA,UAAAA,iBAAAA,IA5FpB,QAASC,GAAcC,GACrB,MAAIC,GAAcD,GAAkBC,EAAcD,GAC3CC,EAAcD,GAAYE,EAAMC,IAAIH,GACzCN,MAAOC,IACNC,KAAK,SAASE,GACf,MAAOA,GAAIM,OAlFfC,KAgEEC,QAAIN,SAAWP,GACXc,EAAAA,UAAad,UAAQc,KAAAA,EAAAA,YACzBC,QAAIC,KAAAA,oGACJhB,EAAIiB,YAAkBA,EAAAA,SACtBjB,EAAIkB,SAAiBA,GAErB,IAAIC,GAAAA,EAAmBnB,YAKvBoB,EAAQC,EAAQJ,UAAmBK,GACjCR,EAAYS,EAASD,WACnBL,EAAeO,EAAAA,aAnEfP,EAoEKjB,EAAAiB,YACLA,EAAQQ,EAAOD,WAnEfE,EAAoB1B,EAAQ0B,mBAAqBN,QAAQO,SACzDR,EAAmBnB,EAAQmB,gBAiF/B,IAVAC,QAAQQ,QAAOX,EAASC,SAAAA,EAAAA,GAEpBX,QAAUgB,SAAAD,GACZL,EAAQY,GAAAA,EAAeC,IAAKvB,GAE5BU,EAAQY,GAAAA,EAAYvB,OAAcP,KApEpCqB,QAAQQ,OAAOX,EAASC,GAyEpBlB,EACFiB,EAAQY,UAAYE,EAAGC,KAAAA,OAEnB,CAAA,IAAIC,EAtER,KAAM,IAAIC,OAAM,6CAFhBjB,GAyEIkB,UAAY7B,EAAAP,GAtDlB,MA6DIC,GAAQoC,gBAEVnB,EAAQY,UAAYE,EAAGC,KAAKf,EAAQY,UAAWvB,EAAcN,EAAQoC,iBAAAA,KAClEjC,SAAKkC,GACJ,GAAIJ,GAAab,QAAQhB,QAAQiC,EAAU,GAK3C,OAJAF,GAAIG,oBAAwBL,EAAA,IAAAM,WAAuBN,WAChDM,KAAAA,EAAW,IAGTvC,EAAQD,GAAAA,aA9EfC,EAAQoC,kBAoFZnB,EAAUe,UAAIf,EAASd,KAAKc,EAAUC,UAAAA,EAAAA,EAAAA,mBAAAA,KAAAA,SAAAA,GAEpC,GAAIX,GAAWmB,QAAAA,QAAkBR,EAAOW,IACpC7B,EAAcmC,EAAA,sBAAAF,EAAA,IAAAM,WAAA,WAAAC,KAAAH,EAAA,GAlFhB,OAmFA9B,GAAWA,aAASkC,EAAQC,OAAeC,SAnFpCV,EAAW,GAAGW,aA0FvBb,EAAAC,IAAAf,GAAAd,KAAA,SAAAe,GAtFA,GAuFEA,GAAQA,EAAAA,EAAAA,UACRd,GAASA,OACTyC,EAAMtC,EAAeuC,QAAAA,cAAAA,kBArFvB,IAyFI1C,GAAIU,QAAYV,QAAA,SAAAoC,KAAAjC,EAAAwC,QAAAC,WAxFhBC,EAyFMC,EAAAA,EAxFV,QACEhC,OAyFME,EAxFNhB,QAASA,EACTyC,KA0FI,SAAWzB,GAxFb,GADAF,EA2FEd,OAAa0C,EACb1C,EAAQ+C,CAER,GAAInC,GAAAA,EAAcF,EAAAI,GAAA,EAChB4B,IA3FA1B,QAAQQ,OAAOsB,EAAWE,SAAUlC,EA+FxC,IAAAmC,GAAOJ,QAAaK,SAAMC,GAAAA,EAAAA,GA5FxBnD,GAAQO,KAAK,0BAA2B0C,GACxCjD,EAAQ+C,WAAWxC,KAAK,0BAA2B0C,GAC/CrC,IACF8B,EAAM9B,GAAgBqC,GAG1B,MAAOJ,GAAOO,MAAM,KAAMD,eAQlC,IAAI/C,MAjFNiD,kBA+DcC,SAAK,KAAA,QAAA,YAAA,WAAA,cAAA,kBA7DnBtC,QA+DMpB,OAAQO,0BAAWoD,QAAA,cAAAF","file":"compiler.min.js","sourcesContent":["'use strict';\r\n\r\n// NOTICE: This file was forked from the angular-material project (github.com/angular/material)\r\n// MIT Licensed - Copyright (c) 2014-2015 Google, Inc. http://angularjs.org\r\n\r\nangular.module('mgcrea.ngStrap.core', [])\r\n  .service('$bsCompiler', bsCompilerService);\r\n\r\nfunction bsCompilerService ($q, $http, $injector, $compile, $controller, $templateCache) {\r\n\r\n  /*\r\n   * @ngdoc service\r\n   * @name $bsCompiler\r\n   * @module material.core\r\n   * @description\r\n   * The $bsCompiler service is an abstraction of angular's compiler, that allows the developer\r\n   * to easily compile an element with a templateUrl, controller, and locals.\r\n   *\r\n   * @usage\r\n   * <hljs lang=\"js\">\r\n   * $bsCompiler.compile({\r\n   *   templateUrl: 'modal.html',\r\n   *   controller: 'ModalCtrl',\r\n   *   locals: {\r\n   *     modal: myModalInstance;\r\n   *   }\r\n   * }).then(function(compileData) {\r\n   *   compileData.element; // modal.html's template in an element\r\n   *   compileData.link(myScope); //attach controller & scope to element\r\n   * });\r\n   * </hljs>\r\n   */\r\n\r\n   /*\r\n    * @ngdoc method\r\n    * @name $bsCompiler#compile\r\n    * @description A helper to compile an HTML template/templateUrl with a given controller,\r\n    * locals, and scope.\r\n    * @param {object} options An options object, with the following properties:\r\n    *\r\n    *    - `controller` - `{(string=|function()=}` Controller fn that should be associated with\r\n    *      newly created scope or the name of a registered controller if passed as a string.\r\n    *    - `controllerAs` - `{string=}` A controller alias name. If present the controller will be\r\n    *      published to scope under the `controllerAs` name.\r\n    *    - `template` - `{string=}` An html template as a string.\r\n    *    - `templateUrl` - `{string=}` A path to an html template.\r\n    *    - `transformTemplate` - `{function(template)=}` A function which transforms the template after\r\n    *      it is loaded. It will be given the template string as a parameter, and should\r\n    *      return a a new string representing the transformed template.\r\n    *    - `resolve` - `{Object.<string, function>=}` - An optional map of dependencies which should\r\n    *      be injected into the controller. If any of these dependencies are promises, the compiler\r\n    *      will wait for them all to be resolved, or if one is rejected before the controller is\r\n    *      instantiated `compile()` will fail..\r\n    *      * `key` - `{string}`: a name of a dependency to be injected into the controller.\r\n    *      * `factory` - `{string|function}`: If `string` then it is an alias for a service.\r\n    *        Otherwise if function, then it is injected and the return value is treated as the\r\n    *        dependency. If the result is a promise, it is resolved before its value is\r\n    *        injected into the controller.\r\n    *\r\n    * @returns {object=} promise A promise, which will be resolved with a `compileData` object.\r\n    * `compileData` has the following properties:\r\n    *\r\n    *   - `element` - `{element}`: an uncompiled element matching the provided template.\r\n    *   - `link` - `{function(scope)}`: A link function, which, when called, will compile\r\n    *     the element and instantiate the provided controller (if given).\r\n    *   - `locals` - `{object}`: The locals which will be passed into the controller once `link` is\r\n    *     called. If `bindToController` is true, they will be coppied to the ctrl instead\r\n    *   - `bindToController` - `bool`: bind the locals to the controller, instead of passing them in.\r\n    */\r\n  this.compile = function (options) {\r\n\r\n    if (options.template && /\\.html$/.test(options.template)) {\r\n      console.warn('Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead.');\r\n      options.templateUrl = options.template;\r\n      options.template = '';\r\n    }\r\n\r\n    var templateUrl = options.templateUrl;\r\n    var template = options.template || '';\r\n    var controller = options.controller;\r\n    var controllerAs = options.controllerAs;\r\n    var resolve = options.resolve || {};\r\n    var locals = options.locals || {};\r\n    var transformTemplate = options.transformTemplate || angular.identity;\r\n    var bindToController = options.bindToController;\r\n\r\n    // Take resolve values and invoke them.\r\n    // Resolves can either be a string (value: 'MyRegisteredAngularConst'),\r\n    // or an invokable 'factory' of sorts: (value: function ValueGetter($dependency) {})\r\n    angular.forEach(resolve, function (value, key) {\r\n      if (angular.isString(value)) {\r\n        resolve[key] = $injector.get(value);\r\n      } else {\r\n        resolve[key] = $injector.invoke(value);\r\n      }\r\n    });\r\n    // Add the locals, which are just straight values to inject\r\n    // eg locals: { three: 3 }, will inject three into the controller\r\n    angular.extend(resolve, locals);\r\n\r\n    if (template) {\r\n      resolve.$template = $q.when(template);\r\n    } else if (templateUrl) {\r\n      resolve.$template = fetchTemplate(templateUrl);\r\n    } else {\r\n      throw new Error('Missing `template` / `templateUrl` option.');\r\n    }\r\n\r\n    if (options.titleTemplate) {\r\n      resolve.$template = $q.all([resolve.$template, fetchTemplate(options.titleTemplate)])\r\n        .then(function (templates) {\r\n          var templateEl = angular.element(templates[0]);\r\n          findElement('[ng-bind=\"title\"]', templateEl[0])\r\n            .removeAttr('ng-bind')\r\n            .html(templates[1]);\r\n          return templateEl[0].outerHTML;\r\n        });\r\n    }\r\n\r\n    if (options.contentTemplate) {\r\n      // TODO(mgcrea): deprecate?\r\n      resolve.$template = $q.all([resolve.$template, fetchTemplate(options.contentTemplate)])\r\n        .then(function (templates) {\r\n          var templateEl = angular.element(templates[0]);\r\n          var contentEl = findElement('[ng-bind=\"content\"]', templateEl[0])\r\n            .removeAttr('ng-bind')\r\n            .html(templates[1]);\r\n          // Drop the default footer as you probably don't want it if you use a custom contentTemplate\r\n          if (!options.templateUrl) contentEl.next().remove();\r\n          return templateEl[0].outerHTML;\r\n        });\r\n    }\r\n\r\n    // Wait for all the resolves to finish if they are promises\r\n    return $q.all(resolve).then(function (locals) {\r\n\r\n      var template = transformTemplate(locals.$template);\r\n      if (options.html) {\r\n        template = template.replace(/ng-bind=\"/ig, 'ng-bind-html=\"');\r\n      }\r\n      // var element = options.element || angular.element('<div>').html(template.trim()).contents();\r\n      var element = angular.element('<div>').html(template.trim()).contents();\r\n      var linkFn = $compile(element);\r\n\r\n      // Return a linking function that can be used later when the element is ready\r\n      return {\r\n        locals: locals,\r\n        element: element,\r\n        link: function link (scope) {\r\n          locals.$scope = scope;\r\n\r\n          // Instantiate controller if it exists, because we have scope\r\n          if (controller) {\r\n            var invokeCtrl = $controller(controller, locals, true);\r\n            if (bindToController) {\r\n              angular.extend(invokeCtrl.instance, locals);\r\n            }\r\n            // Support angular@~1.2 invokeCtrl\r\n            var ctrl = angular.isObject(invokeCtrl) ? invokeCtrl : invokeCtrl();\r\n            // See angular-route source for this logic\r\n            element.data('$ngControllerController', ctrl);\r\n            element.children().data('$ngControllerController', ctrl);\r\n\r\n            if (controllerAs) {\r\n              scope[controllerAs] = ctrl;\r\n            }\r\n          }\r\n\r\n          return linkFn.apply(null, arguments);\r\n        }\r\n      };\r\n    });\r\n\r\n  };\r\n\r\n  function findElement (query, element) {\r\n    return angular.element((element || document).querySelectorAll(query));\r\n  }\r\n\r\n  var fetchPromises = {};\r\n  function fetchTemplate (template) {\r\n    if (fetchPromises[template]) return fetchPromises[template];\r\n    return (fetchPromises[template] = $http.get(template, {cache: $templateCache})\r\n      .then(function (res) {\r\n        return res.data;\r\n      }));\r\n  }\r\n\r\n}\r\n"]}