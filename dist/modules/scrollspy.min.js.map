{"version":3,"sources":["modules/scrollspy.js"],"names":["angular","$get","$document","$rootScope","dimensions","spies","windowEl","defaults","debounce","bodyEl","throttle","nodeName","offset","this","ScrollSpyFactory","config","scrollEl","isWindowSpy","scrollId","element","options","id","$$count","$scrollspy","unbindViewContentLoaded","unbindIncludeContentLoaded","trackedElements","sortedElements","activeTarget","debouncedCheckOffsets","viewportHeight","debouncedCheckPosition","throttledCheckPosition","scrollTop","link","checkPositionWithEventLoop","on","checkOffsets","$on","off","checkPosition","i","isUndefined","prop","docEl","target","$activateElement","length","offsetTop","setTimeout","activeElement","source","$getTrackedElement","addClass","removeClass","parent","filter","targetElement","document","querySelector","trackedElement","el","forEach","b","top","trackElement","push","toDelete","untrackElement","splice","activate","directive","restrict","init","extend","body","scope","key","scrollspy","destroy","compile","childEl","attr","children","querySelectorAll","child"],"mappings":"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","file":"scrollspy.min.js","sourcesContent":["'use strict';\r\n\r\nangular.module('mgcrea.ngStrap.scrollspy', ['mgcrea.ngStrap.helpers.debounce', 'mgcrea.ngStrap.helpers.dimensions'])\r\n\r\n  .provider('$scrollspy', function () {\r\n\r\n    // Pool of registered spies\r\n    var spies = this.$$spies = {};\r\n\r\n    var defaults = this.defaults = {\r\n      debounce: 150,\r\n      throttle: 100,\r\n      offset: 100\r\n    };\r\n\r\n    this.$get = function ($window, $document, $rootScope, dimensions, debounce, throttle) {\r\n\r\n      var windowEl = angular.element($window);\r\n      var docEl = angular.element($document.prop('documentElement'));\r\n      var bodyEl = angular.element($window.document.body);\r\n\r\n      // Helper functions\r\n\r\n      function nodeName (element, name) {\r\n        return element[0].nodeName && element[0].nodeName.toLowerCase() === name.toLowerCase();\r\n      }\r\n\r\n      function ScrollSpyFactory (config) {\r\n\r\n        // Common vars\r\n        var options = angular.extend({}, defaults, config);\r\n        if (!options.element) options.element = bodyEl;\r\n        var isWindowSpy = nodeName(options.element, 'body');\r\n        var scrollEl = isWindowSpy ? windowEl : options.element;\r\n        var scrollId = isWindowSpy ? 'window' : options.id;\r\n\r\n        // Use existing spy\r\n        if (spies[scrollId]) {\r\n          spies[scrollId].$$count++;\r\n          return spies[scrollId];\r\n        }\r\n\r\n        var $scrollspy = {};\r\n\r\n        // Private vars\r\n        var unbindViewContentLoaded;\r\n        var unbindIncludeContentLoaded;\r\n        var trackedElements = $scrollspy.$trackedElements = [];\r\n        var sortedElements = [];\r\n        var activeTarget;\r\n        var debouncedCheckPosition;\r\n        var throttledCheckPosition;\r\n        var debouncedCheckOffsets;\r\n        /* eslint-disable no-unused-vars */\r\n        var viewportHeight;\r\n        /* eslint-enable no-unused-vars */\r\n        var scrollTop;\r\n\r\n        $scrollspy.init = function () {\r\n\r\n          // Setup internal ref counter\r\n          this.$$count = 1;\r\n\r\n          // Bind events\r\n          debouncedCheckPosition = debounce(this.checkPosition, options.debounce);\r\n          throttledCheckPosition = throttle(this.checkPosition, options.throttle);\r\n          scrollEl.on('click', this.checkPositionWithEventLoop);\r\n          windowEl.on('resize', debouncedCheckPosition);\r\n          scrollEl.on('scroll', throttledCheckPosition);\r\n\r\n          debouncedCheckOffsets = debounce(this.checkOffsets, options.debounce);\r\n          unbindViewContentLoaded = $rootScope.$on('$viewContentLoaded', debouncedCheckOffsets);\r\n          unbindIncludeContentLoaded = $rootScope.$on('$includeContentLoaded', debouncedCheckOffsets);\r\n          debouncedCheckOffsets();\r\n\r\n          // Register spy for reuse\r\n          if (scrollId) {\r\n            spies[scrollId] = $scrollspy;\r\n          }\r\n\r\n        };\r\n\r\n        $scrollspy.destroy = function () {\r\n\r\n          // Check internal ref counter\r\n          this.$$count--;\r\n          if (this.$$count > 0) {\r\n            return;\r\n          }\r\n\r\n          // Unbind events\r\n          scrollEl.off('click', this.checkPositionWithEventLoop);\r\n          windowEl.off('resize', debouncedCheckPosition);\r\n          scrollEl.off('scroll', throttledCheckPosition);\r\n          unbindViewContentLoaded();\r\n          unbindIncludeContentLoaded();\r\n          if (scrollId) {\r\n            delete spies[scrollId];\r\n          }\r\n        };\r\n\r\n        $scrollspy.checkPosition = function () {\r\n\r\n          // Not ready yet\r\n          if (!sortedElements.length) return;\r\n\r\n          // Calculate the scroll position\r\n          scrollTop = (isWindowSpy ? $window.pageYOffset : scrollEl.prop('scrollTop')) || 0;\r\n\r\n          // Calculate the viewport height for use by the components\r\n          viewportHeight = Math.max($window.innerHeight, docEl.prop('clientHeight'));\r\n\r\n          // Activate first element if scroll is smaller\r\n          if (scrollTop < sortedElements[0].offsetTop && activeTarget !== sortedElements[0].target) {\r\n            return $scrollspy.$activateElement(sortedElements[0]);\r\n          }\r\n\r\n          // Activate proper element\r\n          for (var i = sortedElements.length; i--;) {\r\n            if (angular.isUndefined(sortedElements[i].offsetTop) || sortedElements[i].offsetTop === null) continue;\r\n            if (activeTarget === sortedElements[i].target) continue;\r\n            if (scrollTop < sortedElements[i].offsetTop) continue;\r\n            if (sortedElements[i + 1] && scrollTop > sortedElements[i + 1].offsetTop) continue;\r\n            return $scrollspy.$activateElement(sortedElements[i]);\r\n          }\r\n\r\n        };\r\n\r\n        $scrollspy.checkPositionWithEventLoop = function () {\r\n          // IE 9 throws an error if we use 'this' instead of '$scrollspy'\r\n          // in this setTimeout call\r\n          setTimeout($scrollspy.checkPosition, 1);\r\n        };\r\n\r\n        // Protected methods\r\n\r\n        $scrollspy.$activateElement = function (element) {\r\n          if (activeTarget) {\r\n            var activeElement = $scrollspy.$getTrackedElement(activeTarget);\r\n            if (activeElement) {\r\n              activeElement.source.removeClass('active');\r\n              if (nodeName(activeElement.source, 'li') && nodeName(activeElement.source.parent().parent(), 'li')) {\r\n                activeElement.source.parent().parent().removeClass('active');\r\n              }\r\n            }\r\n          }\r\n          activeTarget = element.target;\r\n          element.source.addClass('active');\r\n          if (nodeName(element.source, 'li') && nodeName(element.source.parent().parent(), 'li')) {\r\n            element.source.parent().parent().addClass('active');\r\n          }\r\n        };\r\n\r\n        $scrollspy.$getTrackedElement = function (target) {\r\n          return trackedElements.filter(function (obj) {\r\n            return obj.target === target;\r\n          })[0];\r\n        };\r\n\r\n        // Track offsets behavior\r\n\r\n        $scrollspy.checkOffsets = function () {\r\n\r\n          angular.forEach(trackedElements, function (trackedElement) {\r\n            var targetElement = document.querySelector(trackedElement.target);\r\n            trackedElement.offsetTop = targetElement ? dimensions.offset(targetElement).top : null;\r\n            if (options.offset && trackedElement.offsetTop !== null) trackedElement.offsetTop -= options.offset * 1;\r\n          });\r\n\r\n          sortedElements = trackedElements\r\n          .filter(function (el) {\r\n            return el.offsetTop !== null;\r\n          })\r\n          .sort(function (a, b) {\r\n            return a.offsetTop - b.offsetTop;\r\n          });\r\n\r\n          debouncedCheckPosition();\r\n\r\n        };\r\n\r\n        $scrollspy.trackElement = function (target, source) {\r\n          trackedElements.push({target: target, source: source});\r\n        };\r\n\r\n        $scrollspy.untrackElement = function (target, source) {\r\n          var toDelete;\r\n          for (var i = trackedElements.length; i--;) {\r\n            if (trackedElements[i].target === target && trackedElements[i].source === source) {\r\n              toDelete = i;\r\n              break;\r\n            }\r\n          }\r\n          trackedElements.splice(toDelete, 1);\r\n        };\r\n\r\n        $scrollspy.activate = function (i) {\r\n          trackedElements[i].addClass('active');\r\n        };\r\n\r\n        // Initialize plugin\r\n\r\n        $scrollspy.init();\r\n        return $scrollspy;\r\n\r\n      }\r\n\r\n      return ScrollSpyFactory;\r\n\r\n    };\r\n\r\n  })\r\n\r\n  .directive('bsScrollspy', function ($rootScope, debounce, dimensions, $scrollspy) {\r\n\r\n    return {\r\n      restrict: 'EAC',\r\n      link: function postLink (scope, element, attr) {\r\n\r\n        var options = {scope: scope};\r\n        angular.forEach(['offset', 'target'], function (key) {\r\n          if (angular.isDefined(attr[key])) options[key] = attr[key];\r\n        });\r\n\r\n        var scrollspy = $scrollspy(options);\r\n        scrollspy.trackElement(options.target, element);\r\n\r\n        scope.$on('$destroy', function () {\r\n          if (scrollspy) {\r\n            scrollspy.untrackElement(options.target, element);\r\n            scrollspy.destroy();\r\n          }\r\n          options = null;\r\n          scrollspy = null;\r\n        });\r\n\r\n      }\r\n    };\r\n\r\n  })\r\n\r\n\r\n  .directive('bsScrollspyList', function ($rootScope, debounce, dimensions, $scrollspy) {\r\n\r\n    return {\r\n      restrict: 'A',\r\n      compile: function postLink (element, attr) {\r\n        var children = element[0].querySelectorAll('li > a[href]');\r\n        angular.forEach(children, function (child) {\r\n          var childEl = angular.element(child);\r\n          childEl.parent().attr('bs-scrollspy', '').attr('data-target', childEl.attr('href'));\r\n        });\r\n      }\r\n\r\n    };\r\n\r\n  });\r\n"]}